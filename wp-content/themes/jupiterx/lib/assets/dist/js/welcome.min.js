"use strict";var _createClass=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(i,e){function t(){_classCallCheck(this,t),this.setState(),this.setElements(),this.fetchInactiveRequiredPlugins(),this.events()}new(_createClass(t,[{key:"setState",value:function(){this.state={bulkActions:[],plugins:[]}}},{key:"setElements",value:function(){this.el={$pluginList:i(".jupiterx-welcome-rplugins-list"),$progress:i(".jupiterx-welcome-rplugins-progress"),$error:i(".jupiterx-welcome-rplugins-error"),$pluginAction:i(".jupiterx-welcome-rplugins-action"),$actionBtn:i(".jupiterx-welcome-rplugins-action-btn")}}},{key:"events",value:function(){var e=this;i(document).on("click",".jupiterx-welcome-rplugins-action-btn",function(){return e.installPlugins()})}},{key:"installPlugins",value:function(){var e=this,t=this.state.bulkActions;this.el.$actionBtn.addClass("installing").attr("disabled","disabled").find("span:last-child").text(jupiterxWelcome.i18n.installText+"..."),i.ajax({url:t.install_required_plugins.url,method:"POST",data:t.install_required_plugins,success:function(){e.el.$actionBtn.removeClass("installing").removeAttr("disabled").find("span:last-child").text(jupiterxWelcome.i18n.defaultText),e.activatePlugins()},error:function(){e.el.$actionBtn.removeClass("installing").removeAttr("disabled").find("span:last-child").text(jupiterxWelcome.i18n.defaultText)}})}},{key:"activatePlugins",value:function(){var e=this,t=this.state.bulkActions;this.el.$actionBtn.addClass("activating").attr("disabled","disabled").find("span:last-child").text(jupiterxWelcome.i18n.activateText+"..."),i.ajax({url:t.activate_required_plugins.url,method:"POST",data:t.activate_required_plugins,success:function(){e.el.$actionBtn.removeClass("activating").removeAttr("disabled").find("span:last-child").text(jupiterxWelcome.i18n.redirecting+"..."),window.location.href=jupiterxWelcome.controlPanelUrl},error:function(){e.el.$actionBtn.removeClass("activating").removeAttr("disabled").find("span:last-child").text(jupiterxWelcome.i18n.defaultText)}})}},{key:"fetchInactiveRequiredPlugins",value:function(){var t=this;0!==this.el.$pluginList.length&&(this.toggleProgress(!0),e.ajax.post("jupiterx_get_plugins",{_ajax_nonce:this.el.$pluginList.data("nonce")}).done(function(e){return e&&e.bulk_actions&&0!==e.bulk_actions.length&&e&&e.plugins&&0!==e.plugins.length?(t.state.bulkActions=e.bulk_actions,t.insertPlugins(e.plugins),t.toggleProgress(!1),t.toggleError(!1),void t.togglePlugins(!0)):(t.toggleProgress(!1),t.togglePlugins(!1),void t.toggleError(!0))}).fail(function(){t.toggleProgress(!1),t.togglePlugins(!1),t.toggleError(!0)}))}},{key:"insertPlugins",value:function(e){this.el.$pluginList.html("");var t=!0,i=!1,n=void 0;try{for(var l,s=e[Symbol.iterator]();!(t=(l=s.next()).done);t=!0){var r=l.value;this.el.$pluginList.append(this.preparePluginTemplate(r))}}catch(e){i=!0,n=e}finally{try{!t&&s.return&&s.return()}finally{if(i)throw n}}}},{key:"toggleError",value:function(e){e?this.el.$error.css("display","flex"):this.el.$error.css("display","none")}},{key:"toggleProgress",value:function(e){e?this.el.$progress.css("display","flex"):this.el.$progress.css("display","none")}},{key:"togglePlugins",value:function(e){if(e)return this.el.$pluginList.css("display","flex"),void this.el.$pluginAction.css("display","flex");this.el.$pluginList.css("display","none"),this.el.$pluginAction.css("display","none")}},{key:"preparePluginTemplate",value:function(e){return'\n        <div class="jupiterx-welcome-rplugins-list-item">\n          <div class="jupiterx-welcome-rplugins-list-item-header">\n            <img\n              src="'+e.img_url+'"\n              alt="'+e.name+'" />\n          </div>\n          <div class="jupiterx-welcome-rplugins-list-item-body">\n            <div class="jupiterx-welcome-rplugins-list-item-title">\n              '+e.name+'\n            </div>\n            <div class="jupiterx-welcome-rplugins-list-item-desc">\n              '+e.desc+"\n            </div>\n          </div>\n        </div>\n      "}}]),t)}(jQuery,wp);